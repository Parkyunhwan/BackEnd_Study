# :book: :two:주차 정리

### ✔️ TCP vs UDP
- 공통점
  - 포트 번호를 이용하여 주소를 지정한다.
    - 두 애플리케이션이 통신하기 위해 반드시 포트 번호를 결정해야 한다.
  - 데이터 오류를 체크한다. (헤더에 체크섬이 존재)
    - IP가 제공하는 오류 체크 기능은 프로토콜 동작을 위해 반드시 필요한 부분에만 국한된다. 즉 IP헤더에 대한 오류는 체크하지만 데이터에 대한 오류는 체크하지 않는다. 반면, TCP와 UDP는 헤더와 데이터에 대한 오류를 체크한다. 
- 차이점
  - TCP / UDP
  - 연결형 / 비연결형
  - 데이터 경계를 구분x / 데이터 경계를 구분
  - 신뢰적 / 비신뢰적
  - 1대1 통신 / 1대1, 1대다, 다대다 통신
  - 속도가 느림 /  속도가 빠름
  - 패킷 관리가 필요x / 패킷 관리 필요
  - 데이터의 전송 순서 보장 / 데이터의 전송 순서 보장하지 않음
  - 데이터 수신 여부 확인 / 데이터 수신 여부 확인하지 않음

- 3way handshaking
  - [STEP 1]
    - A클라이언트는 B서버에 접속을 요청하는 SYN 패킷을 보낸다. 이때 A클라이언트는 SYN 을 보내고 SYN/ACK 응답을 기다리는SYN_SENT 상태가 되는 것이다.
  - [STEP 2] 
    - B서버는 SYN요청을 받고 A클라이언트에게 요청을 수락한다는 ACK 와 SYN flag 가 설정된 패킷을 발송하고 A가 다시 ACK으로 응답하기를 기다린다. 이때 B서버는 SYN_RECEIVED 상태가 된다.
  - [STEP 3]
    - A클라이언트는 B서버에게 ACK을 보내고 이후로부터는 연결이 이루어지고 데이터가 오가게 되는것이다. 이때의 B서버 상태가 ESTABLISHED 이다. 
  - 위와 같은 방식으로 통신하는것이 신뢰성 있는 연결을 맺어 준다는 TCP의 3 Way handshake 방식이다.
  <img width="617" alt="스크린샷 2021-03-24 오후 7 32 22" src="https://user-images.githubusercontent.com/47052106/112296085-e56e4b00-8cd7-11eb-9c63-61be99e140e0.png">
- 4way handshaking
  - [STEP 1]
    - 클라이언트가 연결을 종료하겠다는 FIN플래그를 전송한다.
  - [STEP 2] 
    - 서버는 일단 확인메시지를 보내고 자신의 통신이 끝날때까지 기다리는데 이 상태가 TIME_WAIT상태다.
  - [STEP 3]
    - 서버가 통신이 끝났으면 연결이 종료되었다고 클라이언트에게 FIN플래그를 전송한다.
  - [STEP 4]
    - 클라이언트는 확인했다는 메시지를 보낸다. 그런데 만약 "Server에서 FIN을 전송하기 전에 전송한 패킷이 Routing 지연이나 패킷 유실로 인한 재전송 등으로 인해 FIN패킷보다 늦게 도착하는 상황"이 발생한다면 어떻게 될까요? 
Client에서 세션을 종료시킨 후 뒤늦게 도착하는 패킷이 있다면 이 패킷은 Drop되고 데이터는 유실될 것입니다. 이러한 현상에 대비하여 Client는 Server로부터 FIN을 수신하더라도 일정시간(디폴트 240초) 동안 세션을 남겨놓고 잉여 패킷을 기다리는 과정을 거치게 되는데 이 과정을 "TIME_WAIT" 라고 합니다.
<img width="605" alt="스크린샷 2021-03-24 오후 7 32 47" src="https://user-images.githubusercontent.com/47052106/112296068-e1422d80-8cd7-11eb-8a27-0fcde8cb35eb.png">

- 클라이언트가 ACK을 받지 못하면?
  - 일정 시간이 지나고도 ACK을 받지 못하면 데이터를 재전송한다.
  
- PDU
  - PDU(Protocol Data Unit)은 통신 프레임을 의미한다. TCP의 PDU는 Segment라고 부르고 UDP의 PDU는 Datagram이라고 하고 IP의 PDU는 Packet이라고 한다. IP 아래 계층의 Link 계층의 PDU를 Frame이라고 한다. Link 계층에 Ethernet이 사용될 때의 PDU는 Ethernet Frame이라고 한다.

### ✔️ REST API
